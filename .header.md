# VPC Module Pre-release docs

This set of documentation is for evaluation purposes only. Docs will be fully rewritten before GA

## Usage

```hcl
module "vpc" {
  source = "git@github.com:aws-ia/terraform-awscc-vpc"

  name           = "multi-az-vpc"
  vpc_cidr_block = "10.0.0.0/20"
  az_count       = 3

  subnets = {
    public = {
      name_prefix               = "my-public" # omit to prefix with "public"
      netmask                   = 24
      nat_gateway_configuration = "all_azs" # options: "single_az", "none"
    }

    private = {
      # omitting name_prefix defaults value to "private"
      # name_prefix  = "private"
      netmask      = 24
      route_to_nat = true
    }
  }

  vpc_flow_logs = {
    log_destination_type = "cloud-watch-logs"
    retention_in_days    = 180
  }
}
```

## Updating a VPC with new or removed subnets

If using `netmask` to calculate subnets and you wish to either add or remove subnets (ex: adding / removing an AZ), you may have to change from using `netmask` for some subnets and set to explicit instead. Private subnets are always calculated before public.

When changing to explicit cidrs, subnets are always ordered by AZ. `0` -> a, `1` -> b, etc.

Example: Changing from 2 azs to 3

Before:
```hcl
vpc_cidr_block = "10.0.0.0/16"
az_count = 2
private = {
    netmask = 24
}
public = {
    netmask = 24
}
```

After:
```hcl
vpc_cidr_block = "10.0.0.0/16"
az_count = 3
private = {
    cidrs = ["10.0.0.0/24", "10.0.1.0/24", "10.0.4.0/24"]
}
public = {
    cidrs = ["10.0.2.0/24", "10.0.3.0/24", "10.0.5.0/24"]
}
```

The above example will cause only creating 2 new subnets in az `c` of the region being used.
